<UserControl x:Class="GamifiedLearningPlatform.Views.StudentDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:GamifiedLearningPlatform.Views"
             xmlns:converters="clr-namespace:GamifiedLearningPlatform.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    <UserControl.Resources>
        <converters:BoolToCompletedStatusConverter x:Key="BoolToCompletedStatusConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <Button Content="← Назад до списку" Command="{Binding DataContext.ShowStudentDashboardCommand, RelativeSource={RelativeSource AncestorType=Window}}" Margin="0,0,20,0" Background="CornflowerBlue"/>
            <TextBlock Text="{Binding SelectedStudent.FullName, StringFormat='Деталі студента: {0}'}" Style="{StaticResource PageTitleStyle}" VerticalAlignment="Center"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <Border Background="White" CornerRadius="5" Padding="20" Margin="0,0,0,20">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Ім'я:" Grid.Row="0" Grid.Column="0" FontWeight="SemiBold" Margin="0,5,15,5"/>
                        <TextBox Text="{Binding SelectedStudent.FirstName, UpdateSourceTrigger=PropertyChanged}" Grid.Row="0" Grid.Column="1" Margin="0,5"/>

                        <TextBlock Text="Прізвище:" Grid.Row="1" Grid.Column="0" FontWeight="SemiBold" Margin="0,5,15,5"/>
                        <TextBox Text="{Binding SelectedStudent.LastName, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="1" Margin="0,5"/>

                        <TextBlock Text="Всього XP:" Grid.Row="2" Grid.Column="0" FontWeight="SemiBold" Margin="0,5,15,5"/>
                        <TextBox Text="{Binding SelectedStudent.TotalXp, UpdateSourceTrigger=PropertyChanged}" Grid.Row="2" Grid.Column="1" Margin="0,5"/>

                        <TextBlock Text="Рівень:" Grid.Row="3" Grid.Column="0" FontWeight="SemiBold" Margin="0,5,15,5"/>
                        <TextBox Text="{Binding SelectedStudent.Level, UpdateSourceTrigger=PropertyChanged}" Grid.Row="3" Grid.Column="1" Margin="0,5"/>
                    </Grid>
                </Border>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" Background="White" CornerRadius="5" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Бейджі" Style="{StaticResource SectionTitleStyle}"/>
                            <ItemsControl ItemsSource="{Binding Badges}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0" TextChanged="BadgeTextBox_TextChanged" Loaded="BadgeTextBox_Loaded" Tag="{Binding}"/>
                                            <Button Content="X" Command="{Binding DataContext.RemoveBadgeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                    CommandParameter="{Binding}" Grid.Column="1" Margin="10,0,0,0" Style="{StaticResource DeleteButton}" Padding="8,4" MinWidth="20" MaxHeight="30"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="Додати бейдж" Command="{Binding AddBadgeCommand}" Margin="0,10,0,0" HorizontalAlignment="Left" MinHeight="25" MinWidth="110" Background="CornflowerBlue"/>
                            <TextBlock Text="User Control Demo:" Style="{StaticResource SectionTitleStyle}" Margin="0,20,0,10"/>
                            <local:BadgeDisplayControl Badges="{Binding Badges}"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="2" Background="White" CornerRadius="5" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Завдання" Style="{StaticResource SectionTitleStyle}"/>
                            <ItemsControl ItemsSource="{Binding Assignments}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Text="{Binding Title, Mode=TwoWay}" Grid.Column="0" Margin="0,0,10,0"/>
                                            <TextBox Text="{Binding XpAward, Mode=TwoWay}" Grid.Column="1" Width="60" Margin="0,0,10,0"/>
                                            <CheckBox IsChecked="{Binding IsCompleted, Mode=TwoWay}" Grid.Column="2" Margin="0,0,10,0">
                                                <CheckBox.ToolTip>
                                                    <TextBlock Text="{Binding IsCompleted, Converter={StaticResource BoolToCompletedStatusConverter}}"/>
                                                </CheckBox.ToolTip>
                                            </CheckBox>
                                            <Button Content="X" Command="{Binding DataContext.RemoveAssignmentCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                    CommandParameter="{Binding}" Grid.Column="3" Style="{StaticResource DeleteButton}" Padding="8,4"  MinWidth="20" MaxHeight="30" />
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Content="Додати завдання" Command="{Binding AddAssignmentCommand}" Margin="0,10,0,0" HorizontalAlignment="Left" MinHeight="25" MinWidth="110" Background="CornflowerBlue"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>

